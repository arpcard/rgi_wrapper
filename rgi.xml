<tool id="rgi" name="Resistance Gene Identifier (RGI)" version="3.2.0">
    <description>This tool predict resistome(s) from protein or nucleotide data based on homology and SNP models.</description>
    <requirements>
        <requirement type="package" version="2.7">python</requirement>
        <requirement type="package" version="3.2.0">rgi</requirement>
        <requirement type="package" version="1.68">biopython</requirement>
        <requirement type="package" version="1.10.0">six</requirement>
        <requirement type="package" version="2.6.3">prodigal</requirement>
        <requirement type="package" version="2.6.0">blast</requirement>
        <requirement type="package" version="0.8.36">diamond</requirement>
        <requirement type="package" version="1.2.8">zlib</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        rgi --input_sequence $input_sequence --input_type $input_type --num_threads "\${GALAXY_SLOTS:-32}" --clean_databases NO --verbose $verbose --alignment_tool $alignment_tool --loose_criteria $loose_criteria --clean $clean --db "${__tool_data_path__}/rgi_databases/$rgi_databases"
    ]]></command>
    <inputs>
        <param type="data" name="input_sequence" format="fastq,fasta" label="Input Sequence"/>
        <param type="select" name="input_type"  label="Input Type" multiple="false">
            <option value="contig" selected="true">CONTIG (Nucluotides Sequence)</option>
            <option value="protein">PROTEIN (Protein Sequence)</option>
            <option value="read">READ (Metagenomics Sequence / FastQ)</option>
        </param>
        <param type="select" name="alignment_tool"  label="Alignment Tool">
            <option value="blast" selected="true">BLAST</option>
            <option value="diamond">DIAMOND</option>
        </param>
        <param type="select" name="verbose"  label="Log progress to file (VERBOSE)" multiple="false">
            <option value="off" selected="true">OFF</option>
            <option value="on">ON</option>
        </param>
        <param type="select" name="clean"  label="Remove temporary files (CLEAN)" multiple="false">
            <option value="yes" selected="true">YES</option>
            <option value="no">NO</option>
        </param>
        <param type="select" name="loose_criteria" label="Include loose hits (CRITERIA)" multiple="false">
          <option value="yes">YES</option>
          <option value="no" selected="true">NO</option>
        </param>
        <param label="Select a RGI database" name="rgi_databases" type="select">
            <options from_data_table="rgi_databases">
                <validator message="No databases are available built-in" type="no_options" />
            </options>
        </param>
    </inputs>
    <outputs>
        <data format="json" name="Report" from_work_dir="Report.json" label="${tool.name} on ${on_string}: (JSON)" />
        <data format="tabular" name="Summary" from_work_dir="Report.txt" label="${tool.name} on ${on_string}: (TXT)" />
        <data format="gff3" name="gff" from_work_dir="Report.gff3" label="${tool.name} on ${on_string}: (GFF3)" >
            <filter>(input_type == 'contig')</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="inType" value="protein"/>
            <param name="inputSeq" value="inputSeq.fasta"/>
            <output name="Report" file="Report.json"/>
        </test>
    </tests>
    <help>
      <![CDATA[
        usage: rgi [-h] [-t INTYPE] [-i INPUTSEQ] [-n THREADS] [-k NUM_SEQUENCES]
                   [-o OUTPUT] [-e CRITERIA] [-c CLEAN] [-cd CLEAN_DATABASES]
                   [-d DATA] [-l VERBOSE] [-a ALIGNER] [-r DATABASE] [-sv] [-dv]

        Resistance Gene Identifier - Version 3.2.0

        optional arguments:
          -h, --help            show this help message and exit
          -t INTYPE, --input_type INTYPE
                                must be one of contig, protein and read (default: contig)

          -i INPUTSEQ, --input_sequence INPUTSEQ
                                input file must be in either FASTA (contig and
                                protein), FASTQ(read) or gzip format! e.g
                                myFile.fasta, myFasta.fasta.gz

          -n THREADS, --num_threads THREADS
                                Number of threads (CPUs) to use in the BLAST search
                                (default=32)

          -k NUM_SEQUENCES, --max_target_seqs NUM_SEQUENCES
                                maximum number of target sequences to report
                                alignments for (default=1)

          -o OUTPUT, --output_file OUTPUT
                                Output JSON file (default=Report)

          -e CRITERIA, --loose_criteria CRITERIA
                                The options are YES to include loose hits and NO to
                                exclude loose hits. (default=NO to exclude loose hits)

          -c CLEAN, --clean CLEAN
                                This removes temporary files in the results directory
                                after run. Options are NO or YES (default=YES for remove)

          --clean_databases CLEAN_DATABASES
                                This removes blast databases before rgi run. Options
                                are NO or YES (default=YES for remove)

          -d DATA, --data DATA  Specify a data-type, i.e. wgs, chromosome, plasmid,
                                etc. (default = NA)

          -l VERBOSE, --verbose VERBOSE
                                log progress to file. Options are OFF or ON (default =
                                OFF for no logging)

          -a ALIGNER, --alignment_tool ALIGNER
                                choose between BLAST and DIAMOND. Options are BLAST or
                                DIAMOND (default = BLAST)

          -r DATABASE, --db DATABASE
                                specify path to CARD blast databases (default: None)

          -sv, --software_version
                                Prints software number

          -dv, --data_version   
                                Prints data version number
    ]]>
    </help>
    <citations>
        <citation type="bibtex">
@misc{renameTODO,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {TODO},
  url = {https://card.mcmaster.ca/about},
}</citation>
    </citations>
</tool>