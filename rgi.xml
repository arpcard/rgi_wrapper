<tool id="rgi" name="Resistance Gene Identifier (RGI)" version="4.2.2">
    <description>This tool predicts resistome(s) from protein or nucleotide data based on homology and SNP models.</description>
    <requirements>
        <requirement type="package" version="3.6">python</requirement>
        <requirement type="package" version="4.2.2">rgi</requirement>
        <requirement type="package" version="1.68">biopython</requirement>
        <requirement type="package" version="1.10.0">six</requirement>
        <requirement type="package" version="2.6.3">prodigal</requirement>
        <requirement type="package" version="2.6.0">blast</requirement>
        <requirement type="package" version="0.8.36">diamond</requirement>
		<requirement type="package" version="1.2.8">zlib</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
	<command><![CDATA[
rgi load 
	-i "${__tool_data_path__}/rgi_databases/$rgi_database/card.json"
&&
rgi main
	-i $input_sequence
	-o out
	-t $input_type
	-a $alignment_tool
	-n "\${GALAXY_SLOTS:-1}"
	$include_loose
	$clean
	$low_quality
	-d $data_type
   	]]></command>
    <inputs>
        <param name="input_sequence" type="data" format="fastq,fasta" label="Input sequence"/>
        <param name="input_type" type="select" multiple="false" label="Input type">
            <option value="read">READ (Metagenomics Sequence / FastQ)</option>
            <option value="contig" selected="true">CONTIG (Nucleotide Sequence)</option>
            <option value="protein">PROTEIN (Protein Sequence)</option>
            <option value="wgs">WGS (Whole Genome Sequence)</option>
        </param>
        <param name="alignment_tool" type="select" label="Alignment tool">
            <option value="blast" selected="true">BLAST</option>
            <option value="diamond">DIAMOND</option>
		</param>
		<param name="include_loose" type="boolean" checked="false" truevalue="--include_loose" falsevalue="" label="Include loose hits"/>
		<param name="clean" type="boolean" checked="false" truevalue="--clean" falsevalue="" label="Remove temporary files"/>
		<param name="low_quality" type="boolean" checked="false" truevalue="--low_quality" falsevalue="" label="Low quality"/>
		<param name="data_type" type="select" multiple="false" label="Data type">
			<option value="wgs">WGS</option>
			<option value="plasmid">PLASMID</option>
			<option value="chromosome">CHROMOSOME</option>
            <option value="NA" selected="true">NA</option>
		</param>
        <param name="rgi_database" type="select" label="Select an RGI database">
            <options from_data_table="rgi_databases">
                <validator type="no_options" message="No databases are available built-in"/>
            </options>
        </param>
    </inputs>
    <outputs>
        <data name="report" format="json" from_work_dir="out.json" label="${tool.name} on ${on_string}: report.json"/>
        <data name="summary" format="tabular" from_work_dir="out.txt" label="${tool.name} on ${on_string}: summary.txt"/>
    </outputs>
    <tests>
    </tests>
    <help>
	<![CDATA[
Resistance Gene Identifier (RGI)
================================

RGI is used to predict resistome(s) from protein or nucleotide data based on homology and SNP models. The tool uses data from the CARD database.

Usage
-----

1. Select your input sequence (in FASTA format).
2. Select your input type (READ, CONTIG, PROTEIN or WGS).
3. Select your alignment tool (DIAMOND or BLAST).  
4. Specify if you want to include loose hits (YES or NO).
5. Specify if you want to remove temporary files (YES or NO).
6. Specify if you want to low quality predictions (YES or NO).
7. Select your data type (WGS, PLASMID, CHROMOSOME or NA). 
8. Run the tool.

Output
------

There are 2 different output files produced by `rgi`.

summary.txt
^^^^^^^^^^^

A tabular file of all detected resistance genes, one gene per line.

+--------------------------------------------------------------------------------------------------------------------------+---------------+-------+------+-------------+----------+----------------+---------------------+----------------+------------------+----------+-----------------------+--------------------------+-------------+------------+-------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------+--------------------------------+-----------+
| ORF_ID                                                                                                                   | Contig        | Start | Stop | Orientation | Cut_Off  | Pass_Bitscore  | Best_Hit_Bitscore   | Best_Hit_ARO   | Best_Identities  | ARO      | Model_type            | SNPs_in_Best_Hit_ARO     | Other_SNPs  | Drug Class | Resistance Mechanism    | AMR Gene Family      | Predicted_DNA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Predicted_Protein                                                                                                                                                                                                                                                                                                | CARD_Protein_Sequence                                                                                                                                                                                                                                                                            | Percentage Length of Reference Sequence | ID                             | Model_ID  |
+==========================================================================================================================+===============+=======+======+=============+==========+================+=====================+================+==================+==========+=======================+==========================+=============+============+=========================+======================+=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+==================================================================================================================================================================================================================================================================================================================+==================================================================================================================================================================================================================================================================================================+=========================================+================================+===========+
| AY123251.1_6 # 3575 # 4489 # 1 # ID=1_6;partial=00;start_type=ATG;rbs_motif=None;rbs_spacer=None;gc_cont=0.399           | AY123251.1_6  | 3575  | 4489 | +           | Strict   | 500            | 506.908             | CARB-7         | 83.68            | 3002246  | protein homolog model | n/a                      | n/a         | penam      | antibiotic inactivation | CARB beta-lactamase  | ATGCTTTTATATAAAATGTGTGACAATCAAAATTATGGGGTTACTTACATGAAGTTTTTATTGGTATTTTCGCTTTTAATACCATCCGTGGTTTTTGCAAGTAGTTCAAAGTTTCGGCAAGTTGAACAAGACGTTAAGGCAATTGAAGTTTCTCTTTCTGCTCGTATAGGTGTTTCCGTTCTTGATACTCAAAATGGAGAATACTGGGATTACAATGGCAATCAGCGCTTCCCGTTGACAAGTACTTTTAAAACAATAGCTTGCGCTAAATTACTATATGATGCTGAGCAAGGAAAAGTTAATCCCAATAGTACAATCGAGATTAAGAAAGCAGATCTTGTGACCTATTCCCCTGTAATAGAAAAGCAAGTAGGGCAGGCAATCACACTCGATGATGCGTGCTTCGCAACTATGACTACAAGTGATAATACTGCGGCAAATATCATCCTAAGTGCTGTAGGTGGCTCCAAAGGCGTTACTGATTTTTTAAGACAAATTGGGGACAAAGAGACTCGTCTAGACCGTATTGAGCCTGATTTAAATGAAGGTAAGCTCGGTGATTTGAGGGATACGACAACTCCTAAGGCAATAGCCAGTACTTTGAATAAATTTTTATTTGGTTCAGCGCTATCTGAAATGAACAAAAAAAAATTAGAGTCTTGGATGGTGAACAATCAAGTCACTGGTAATTTACTACGTTCAGTATTGCCGGCGGGATGGAACATTGCGGATCGTTCAGGTGCTGGCGGATTTGGTGCTCGGAGTATTACAGCAGTTGTGTGGAGTGAGCATCAAGCCCCAATTATTGTGAGCATCTATCTAGCTCAAACACAGGCTTCAATGGCAGAGCGAAATGATGCGATTGTTAAAATTGGTCGTTCAATTTTTGACGTTTATACATCACAGTCGCGCTGA | MLLYKMCDNQNYGVTYMKFLLVFSLLIPSVVFASSSKFRQVEQDVKAIEVSLSARIGVSVLDTQNGEYWDYNGNQRFPLTSTFKTIACAKLLYDAEQGKVNPNSTIEIKKADLVTYSPVIEKQVGQAITLDDACFATMTTSDNTAANIILSAVGGSKGVTDFLRQIGDKETRLDRIEPDLNEGKLGDLRDTTTPKAIASTLNKFLFGSALSEMNKKKLESWMVNNQVTGNLLRSVLPAGWNIADRSGAGGFGARSITAVVWSEHQAPIIVSIYLAQTQASMAERNDAIVKIGRSIFDVYTSQSR | MKSLLVFALLMPSVVFASSSKFQSVEQEIKGIESSLSARIGVAILDTQNGESWDYNGDQRFPLTSTFKTIACAKLLYDAEHGKVNLNSTVEIKKADLVTYSPVLEKQVGKPITLSDACLATMTTSDNTAANIVINAVGDPKSITDFLRQIGDKETRLDRVEPELNEGKLGDLRDTTTPNAITSTLNQLLFGSTLSEASQKKLESWMVNNQVTGNLLRSVLPVKWSIADRSGAGGFGARSITAIVWSEEKKPIIVSIYLAQTEASMAERNDAIVKIGRSIFEVYTSQSR | 105.56                                  | gnl|BL_ORD_ID|589|hsp_num:0    | 1443      |
+--------------------------------------------------------------------------------------------------------------------------+---------------+-------+------+-------------+----------+----------------+---------------------+----------------+------------------+----------+-----------------------+--------------------------+-------------+------------+-------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------+--------------------------------+-----------+

report.json
^^^^^^^^^^^

A json version of summary.txt.

Help
----

**usage:**
    ``rgi main [-h] -i INPUT_SEQUENCE -o OUTPUT_FILE [-t {read,contig,protein,wgs}] [-a {DIAMOND,BLAST}] [-n THREADS] [--include_loose] [--local] [--clean] [--debug] [--low_quality] [-d {wgs,plasmid,chromosome,NA}] [-v]``

**optional arguments:**

- ``-h, --help``
    show this help message and exit
- ``-i INPUT_SEQUENCE, --input_sequence INPUT_SEQUENCE``
    input file must be in either FASTA (contig and protein), FASTQ(read) or gzip format! e.g myFile.fasta, myFasta.fasta.gz
- ``-o OUTPUT_FILE, --output_file OUTPUT_FILE``
    output folder and base filename
- ``-t {read,contig,protein,wgs}, --input_type {read,contig,protein,wgs}``
    specify data input type (default = contig)
- ``-a {DIAMOND,BLAST}, --alignment_tool {DIAMOND,BLAST}``
    specify alignment tool (default = BLAST)
- ``-n THREADS, --num_threads THREADS``
    number of threads (CPUs) to use in the BLAST search (default=8)
- ``--include_loose``
    include loose hits in addition to strict and perfect hits
- ``--local``
    use local database (default: uses database in executable directory)
- ``--clean``
    removes temporary files
- ``--debug``
    debug mode
- ``--low_quality``
    use for short contigs to predict partial genes
- ``-d {wgs,plasmid,chromosome,NA}, --data {wgs,plasmid,chromosome,NA}``
    specify a data-type (default = NA)
- ``-v, --version``
    prints software version number

Links
-----

RGI: https://card.mcmaster.ca/analyze/rgi

Github: https://github.com/phac-nml/rgi

CARD database: https://card.mcmaster.ca
 	]]>
    </help>
    <citations>
    	<citation type="bibtex">
@ARTICLE{CARD2017,
  author = {Jia B, Raphenya AR, Alcock B, Waglechner N, Guo P, Tsang KK, Lago BA, Dave BM, Pereira S, Sharma AN, Doshi S, Courtot M, Lo R, Williams LE, Frye JG, Elsayegh T, Sardar D, Westman EL, Pawlowski AC, Johnson TA, Brinkman FS, Wright GD, McArthur AG},
  year = {2017},
  title = {CARD 2017: expansion and model-centric curation of the comprehensive antibiotic resistance database.},
  url = {https://card.mcmaster.ca/about},
}		</citation>
    </citations>
</tool>
